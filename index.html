<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Diagnostics Platform - AI-Powered Breast Density Analysis</title>

    <!-- Meta Information -->
    <meta name="description"
        content="Advanced AI-powered medical diagnostics platform for breast density classification and mammography analysis.">
    <meta name="keywords" content="medical diagnostics, AI analysis, breast density, mammography, healthcare">
    <meta name="author" content="Medical Diagnostics Platform">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='40' fill='%230066cc'/><path d='M35 45h30v10H35z' fill='white'/><path d='M45 35h10v30H45z' fill='white'/></svg>">

    <!-- CSS Files -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/medical-theme.css">

    <!-- Preload Critical Resources -->
    <link rel="preload" href="js/app.js" as="script">
    <link rel="preload" href="js/mock-api.js" as="script">

    <!-- Font Loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="logo">
                <div class="logo-icon">üè•</div>
                <span>Medical Diagnostics</span>
            </div>
            <div class="loading-spinner"></div>
            <p>Initializing platform...</p>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app" class="app" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <!-- Logo and Branding -->
                    <a href="#" class="logo">
                        <div class="logo-icon">üè•</div>
                        <span>Medical Diagnostics</span>
                    </a>

                    <!-- Navigation Actions -->
                    <div class="nav-actions">
                        <!-- API Status Indicator -->
                        <div class="api-status" id="api-status"
                            style="display: flex; align-items: center; gap: 0.5rem; margin-right: 1rem;">
                            <span class="api-status-dot" id="api-status-dot"
                                style="width: 8px; height: 8px; border-radius: 50%; background: #ffc107;"></span>
                            <span class="api-status-text" id="api-status-text"
                                style="font-size: 0.875rem; color: var(--dark-gray);">Checking API...</span>
                        </div>
                    
                        <button class="btn btn-secondary" id="settings-btn" title="Settings">
                            ‚öôÔ∏è Settings
                        </button>
                        <button class="btn btn-primary btn-diagnose" id="diagnose-btn">
                            üìã New Diagnosis
                        </button>             
                     </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <!-- Dashboard Header -->
                <section class="dashboard-header">
                    <h1 class="dashboard-title">AI-Powered Medical Diagnostics</h1>
                    <p class="dashboard-subtitle">
                        Advanced breast density classification and mammography analysis using cutting-edge artificial
                        intelligence
                    </p>
                </section>

                <!-- Quick Stats -->
                <section class="quick-stats glass-card"
                    style="padding: var(--spacing-lg); margin-bottom: var(--spacing-xl);">
                    <div class="stats-grid"
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-lg);">
                        <div class="stat-item">
                            <div class="stat-value" id="total-requests">0</div>
                            <div class="stat-label">Total Requests</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="completed-requests">0</div>
                            <div class="stat-label">Completed</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="pending-requests">0</div>
                            <div class="stat-label">Processing</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="success-rate">0%</div>
                            <div class="stat-label">Success Rate</div>
                        </div>
                    </div>
                </section>

                <!-- Search and Filter Bar -->
                <section class="search-filter-bar">
                    <div class="search-input-group">
                        <span class="search-icon">üîç</span>
                        <input type="text" class="search-input" placeholder="Search by filename, ID, or notes..."
                            id="search-input">
                    </div>
                    <select class="filter-select" id="sort-select">
                        <option value="newest">Newest First</option>
                        <option value="oldest">Oldest First</option>
                        <option value="filename">Filename A-Z</option>
                        <option value="status">Status</option>
                    </select>
                    <button class="btn btn-secondary" id="clear-filters">Clear Filters</button>
                </section>

                <!-- Status Filter Tabs -->
                <section class="status-filters">
                    <button class="filter-tab active" data-status="all">
                        All Requests
                        <span class="filter-count">0</span>
                    </button>
                    <button class="filter-tab" data-status="completed">
                        Completed
                        <span class="filter-count">0</span>
                    </button>
                    <button class="filter-tab" data-status="pending">
                        Pending
                        <span class="filter-count">0</span>
                    </button>
                    <button class="filter-tab" data-status="processing">
                        Processing
                        <span class="filter-count">0</span>
                    </button>
                    <button class="filter-tab" data-status="failed">
                        Failed
                        <span class="filter-count">0</span>
                    </button>
                </section>

                <!-- Requests Grid -->
                <section class="requests-section">
                    <div class="requests-grid" id="requests-grid">
                        <!-- Request cards will be dynamically inserted here -->

                        <!-- Loading State -->
                        <div class="loading-state" id="loading-state" style="display: none;">
                            <div class="glass-card" style="padding: var(--spacing-xl); text-align: center;">
                                <div class="loading-spinner" style="margin: 0 auto var(--spacing-md);"></div>
                                <p>Loading diagnostic requests...</p>
                            </div>
                        </div>

                        <!-- Empty State -->
                        <div class="empty-state" id="empty-state" style="display: none;">
                            <div class="empty-icon">üìã</div>
                            <h3 class="empty-title">No diagnostic requests yet</h3>
                            <p class="empty-description">
                                Start by creating your first diagnostic request to analyze medical images with
                                AI-powered insights.
                            </p>
                            <button class="btn btn-primary btn-diagnose">Create First Request</button>
                        </div>
                    </div>

                    <!-- Load More Button -->
                    <div class="load-more-section" style="text-align: center; margin-top: var(--spacing-xl);">
                        <button class="btn btn-secondary" id="load-more-btn" style="display: none;">
                            Load More Requests
                        </button>
                    </div>
                </section>

                <!-- Help Section -->                
                <section class="help-section glass-card" style="margin-top: var(--spacing-xxl); padding: var(--spacing-xl);">
                    <h3>Getting Started</h3>
                    <div class="help-grid"
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-lg); margin-top: var(--spacing-lg);">
                        <div class="help-item">
                            <div class="help-icon">üì§</div>
                            <h4>1. Upload Images</h4>
                            <p>Upload mammography images in JPEG, PNG, or DICOM format. Maximum file size is 50MB.</p>
                        </div>
                        <div class="help-item">
                            <div class="help-icon">üîë</div>
                            <h4>2. API Configuration</h4>
                            <p>The system automatically connects to the AI analysis service. No additional configuration needed.</p>
                        </div>
                        <div class="help-item">
                            <div class="help-icon">ü§ñ</div>
                            <h4>3. AI Analysis</h4>
                            <p>Real AI analysis when available, or high-quality demo data when the service is unavailable.</p>
                        </div>
                        <div class="help-item">
                            <div class="help-icon">üìä</div>
                            <h4>4. View Results</h4>
                            <p>Access PDF reports from real AI analysis or detailed markdown reports in demo mode.</p>
                        </div>
                    </div>
                
                    <!-- API Status Information -->
                    <div style="margin-top: 2rem; padding: 1rem; background: var(--secondary-blue); border-radius: 8px;">
                        <h4 style="margin-bottom: 1rem;">üîó Analysis Service Status</h4>
                        <div id="api-help-status">
                            <p>Checking connection to AI analysis service...</p>
                        </div>
                    </div>
                </section>
                
                <!-- Debug Panel (Development Only) -->
                <section class="debug-panel" id="debug-panel" style="display: none; margin-top: 2rem;">
                    <div class="glass-card" style="padding: 1rem;">
                        <h3>API Debug Panel</h3>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin: 1rem 0;">
                            <button class="btn btn-secondary" onclick="window.testAPIConnection()">
                                üîç Test API Connection
                            </button>
                            <button class="btn btn-secondary" onclick="window.refreshAPIStatus()">
                                üîÑ Refresh API Status
                            </button>
                            <button class="btn btn-secondary" onclick="window.forceDemoMode()">
                                üé≠ Force Demo Mode
                            </button>
                            <button class="btn btn-secondary" onclick="toggleDebugPanel()">
                                ‚ùå Hide Debug Panel
                            </button>
                        </div>
                        <div id="debug-info"
                            style="background: #f8f9fa; padding: 1rem; border-radius: 4px; font-family: monospace; font-size: 0.875rem;">
                            Debug information will appear here...
                        </div>
                    </div>
                </section>
            </div>
         </main>

        <!-- Footer -->
        <footer class="footer"
            style="margin-top: var(--spacing-xxl); padding: var(--spacing-xl) 0; background: var(--glass-bg); backdrop-filter: blur(16px); border-top: 1px solid var(--glass-border);">
            <div class="container">
                <div class="footer-content"
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-lg);">
                    <div class="footer-section">
                        <h4>Medical Diagnostics Platform</h4>
                        <p>Advanced AI-powered diagnostic analysis for healthcare professionals.</p>
                        <p><small>Demo Version - For demonstration purposes only</small></p>
                    </div>
                    <div class="footer-section">
                        <h4>Features</h4>
                        <ul style="list-style: none; padding: 0;">
                            <li>‚Ä¢ Breast density classification</li>
                            <li>‚Ä¢ BI-RADS categorization</li>
                            <li>‚Ä¢ Automated report generation</li>
                            <li>‚Ä¢ DICOM image support</li>
                        </ul>
                    </div>
                    <div class="footer-section">
                        <h4>Support</h4>
                        <ul style="list-style: none; padding: 0;">
                            <li><a href="#" class="medical-link">Documentation</a></li>
                            <li><a href="#" class="medical-link">API Reference</a></li>
                            <li><a href="#" class="medical-link">Contact Support</a></li>
                            <li><a href="#" class="medical-link">Privacy Policy</a></li>
                        </ul>
                    </div>
                </div>
                <div class="footer-bottom"
                    style="text-align: center; margin-top: var(--spacing-lg); padding-top: var(--spacing-lg); border-top: 1px solid var(--medium-gray);">
                    <p>&copy; 2025 Medical Diagnostics Platform. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- JavaScript Files -->
    <script src="js/mock-api.js"></script>
    <script src="js/ui-components.js"></script>
    <script src="js/markdown-renderer.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/app.js"></script>

    <!-- Initialization Script -->
    <script>
        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            // Hide loading screen
            setTimeout(function() {
                const loadingScreen = document.getElementById('loading-screen');
                const app = document.getElementById('app');
                
                if (loadingScreen && app) {
                    loadingScreen.style.opacity = '0';
                    setTimeout(function() {
                        loadingScreen.style.display = 'none';
                        app.style.display = 'block';
                        app.style.opacity = '0';
                        app.style.animation = 'fadeIn 0.5s ease-out forwards';
                    }, 300);
                }
            }, 1500);

            // Update stats periodically
            function updateStats() {
                if (window.app && window.app.requests) {
                    const requests = window.app.requests;
                    const stats = {
                        total: requests.length,
                        completed: requests.filter(r => r.status === 'completed').length,
                        pending: requests.filter(r => r.status === 'pending' || r.status === 'processing').length,
                        failed: requests.filter(r => r.status === 'failed').length
                    };

                    // Update DOM
                    const totalEl = document.getElementById('total-requests');
                    const completedEl = document.getElementById('completed-requests');
                    const pendingEl = document.getElementById('pending-requests');
                    const successRateEl = document.getElementById('success-rate');

                    if (totalEl) totalEl.textContent = stats.total;
                    if (completedEl) completedEl.textContent = stats.completed;
                    if (pendingEl) pendingEl.textContent = stats.pending;
                    if (successRateEl) {
                        const rate = stats.total > 0 ? Math.round((stats.completed / stats.total) * 100) : 0;
                        successRateEl.textContent = rate + '%';
                    }
                }
            }

            // Update stats every 5 seconds
            setInterval(updateStats, 5000);
            
            // Initial stats update
            setTimeout(updateStats, 2000);
        });

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            .loading-screen {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                transition: opacity 0.3s ease;
            }
            
            .loading-content {
                text-align: center;
                color: white;
            }
            
            .loading-content .logo {
                margin-bottom: 2rem;
                font-size: 2rem;
                font-weight: 600;
            }
            
            .loading-content p {
                margin-top: 1rem;
                opacity: 0.9;
            }
            
            .stat-item {
                text-align: center;
            }
            
            .stat-value {
                font-size: 2rem;
                font-weight: 700;
                color: var(--primary-blue);
                margin-bottom: 0.5rem;
            }
            
            .stat-label {
                font-size: 0.875rem;
                color: var(--dark-gray);
                text-transform: uppercase;
                letter-spacing: 0.05em;
            }
            
            .help-icon {
                font-size: 3rem;
                margin-bottom: 1rem;
            }
            
            .help-item {
                text-align: center;
            }
            
            .help-item h4 {
                color: var(--primary-blue);
                margin-bottom: 0.5rem;
            }
            
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
            }
            
            .app {
                min-height: 100vh;
                display: flex;
                flex-direction: column;
            }
            
            .main-content {
                flex: 1;
                padding: var(--spacing-xl) 0;
            }
            
            .footer {
                margin-top: auto;
            }
            
            .medical-link {
                color: var(--primary-blue);
                text-decoration: none;
                transition: color 0.15s ease;
            }
            
            .medical-link:hover {
                color: var(--primary-blue-dark);
                text-decoration: underline;
            }
        `;
        document.head.appendChild(style);
    </script>


    <!-- 1. Add the new JavaScript files before the closing </body> tag -->
    <!-- Add these lines after your existing script tags and before the initialization script -->

    <script src="js/fetch-api.js"></script>
    <script src="js/fetch-api-integration.js"></script>


    <!-- 3. Add API status update script -->
    <script>
        // Update API status indicator
        function updateAPIStatus(isAvailable, message) {
            const dot = document.getElementById('api-status-dot');
            const text = document.getElementById('api-status-text');

            if (dot && text) {
                if (isAvailable) {
                    dot.style.background = '#28a745';
                    text.textContent = 'Real AI Available';
                    text.style.color = '#28a745';
                } else {
                    dot.style.background = '#ffc107';
                    text.textContent = 'Demo Mode';
                    text.style.color = '#ffc107';
                }

                if (message) {
                    text.title = message;
                }
            }
        }

        // Listen for API status changes
        document.addEventListener('DOMContentLoaded', function () {
            // Initial status check
            setTimeout(async () => {
                if (window.hybridAPI) {
                    try {
                        const useRealAPI = await window.hybridAPI.initializeAPIMode();
                        updateAPIStatus(useRealAPI, useRealAPI ? 'Connected to real AI analysis service' : 'Real API unavailable, using demo data');
                    } catch (error) {
                        updateAPIStatus(false, 'Error checking API status');
                    }
                }
            }, 2000);
        });
    </script>

    <script>
        // Debug panel functions
        function toggleDebugPanel() {
            const panel = document.getElementById('debug-panel');
            if (panel) {
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            }
        }

        // Enable debug panel with Ctrl+Shift+D
        document.addEventListener('keydown', function (e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                toggleDebugPanel();
                updateDebugInfo();
            }
        });

        function updateDebugInfo() {
            const debugInfo = document.getElementById('debug-info');
            if (debugInfo && window.hybridAPI) {
                const info = {
                    'API Mode': window.hybridAPI.useRealAPI ? 'Real API' : 'Demo Mode',
                    'Base URL': window.hybridAPI.realAPI ? window.hybridAPI.realAPI.baseUrl : 'N/A',
                    'Requests Count': window.app ? window.app.requests.length : 'N/A',
                    'Storage Available': !!window.storage,
                    'PDF Blobs Stored': window.hybridAPI.storage ? 'Available' : 'N/A',
                    'Timestamp': new Date().toLocaleString()
                };

                debugInfo.innerHTML = Object.entries(info)
                    .map(([key, value]) => `<strong>${key}:</strong> ${value}`)
                    .join('<br>');
            }
        }
    </script>



    <script>
        // Update help section API status
        document.addEventListener('DOMContentLoaded', function () {
            setTimeout(async () => {
                const statusDiv = document.getElementById('api-help-status');
                if (statusDiv && window.hybridAPI) {
                    try {
                        const useRealAPI = window.hybridAPI.useRealAPI;
                        if (useRealAPI === true) {
                            statusDiv.innerHTML = `
                            <p style="color: #28a745; font-weight: 500;">‚úÖ Real AI Analysis Service Connected</p>
                            <p style="font-size: 0.875rem;">Your requests will be processed by our advanced AI system and return detailed PDF reports.</p>
                        `;
                        } else if (useRealAPI === false) {
                            statusDiv.innerHTML = `
                            <p style="color: #ffc107; font-weight: 500;">üé≠ Demo Mode Active</p>
                            <p style="font-size: 0.875rem;">The AI analysis service is unavailable. Using high-quality demonstration data for testing the interface.</p>
                        `;
                        } else {
                            statusDiv.innerHTML = `
                            <p style="color: #6c757d;">üîç Status: Checking...</p>
                        `;
                        }
                    } catch (error) {
                        statusDiv.innerHTML = `
                        <p style="color: #dc3545;">‚ùå Error checking service status</p>
                    `;
                    }
                }
            }, 3000);
        });
    </script>



</body>

</html>